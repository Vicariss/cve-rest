from flask import Blueprint, abort, jsonify
from application import db_client


main_bp = Blueprint("main_bp", __name__)

# @main_bp.route('/cve')
@main_bp.route('/cve/<int:amount>')
def get(amount):
    if amount > 50:
        return "You've requested too many CVEs. Maximum value is 50."
    try:
        db = db_client.cve_db
        collection = db.cve
        results = collection.find().limit(amount).sort("date")
        
        cve_data = []

        for cve in results:
            cve_object = {
                "title": cve["title"],
                "content": cve["content"],
                "date": cve["date"],
                "references": cve["references"]         
            }
            cve_data.append(cve_object)

        return {"data": cve_data}

    except Exception as e:
        print(e)

